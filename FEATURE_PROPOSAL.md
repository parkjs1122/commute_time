# 출퇴근 시간 (Commute Time) 기능 개선 기획안

> 작성일: 2026-02-22
> 현재 버전 분석 기반

---

## 현재 상태 요약

| 항목 | 현황 |
|------|------|
| 핵심 기능 | 실시간 대중교통 ETA 대시보드 |
| 지원 교통수단 | 서울/경기 버스, 서울 지하철, 시외/고속버스, 도보 |
| 사용자 관리 | 이메일 회원가입/로그인, 최대 5개 경로 저장 |
| 기술 스택 | Next.js 16 + React 19 + PostgreSQL + Prisma |
| 배포 환경 | Vercel (서버리스) |
| 코드 규모 | ~5,000줄 TypeScript |

---

## 1. PWA (Progressive Web App) 전환

### 배경
현재 웹 브라우저에서만 접근 가능하며, 매번 URL을 입력하거나 북마크를 통해 접속해야 한다. 출퇴근 앱 특성상 모바일에서 빠르게 접근하는 것이 핵심이다.

### 개선 내용
- **홈 화면 추가(A2HS)**: 앱 아이콘으로 홈 화면에 설치, 네이티브 앱처럼 실행
- **Service Worker**: 오프라인 시 마지막 조회 데이터 표시, 앱 셸 캐싱으로 즉시 로딩
- **Web App Manifest**: 앱 이름, 아이콘, 테마 색상, 스플래시 화면 설정

### 기대 효과
- 앱 접근성 대폭 향상 (1탭으로 실행)
- 초기 로딩 속도 개선 (캐싱된 앱 셸)
- 네이티브 앱 개발 없이 앱 유사 경험 제공

### 구현 범위
- `public/manifest.json` 작성
- Service Worker 등록 (`next-pwa` 또는 Serwist 활용)
- 앱 아이콘 제작 (192x192, 512x512)
- 오프라인 폴백 페이지

### 우선순위: ★★★★★ (최우선)
### 예상 난이도: 중

---

## 2. 푸시 알림 (출발 알림)

### 배경
현재 대시보드를 직접 열어야만 도착 시간을 확인할 수 있다. 출발 시간이 임박했을 때 알림을 받으면 놓치지 않고 출발할 수 있다.

### 개선 내용
- **출발 알림 설정**: "버스 도착 5분 전 알림", "지하철 도착 3분 전 알림" 등 사용자가 설정
- **Web Push API**: Service Worker 기반 푸시 알림 전송
- **알림 시간대 설정**: 평일 출근/퇴근 시간대에만 알림 활성화

### 기대 효과
- 앱을 열지 않아도 출발 타이밍 파악
- 놓치는 버스/지하철 감소

### 구현 범위
- Web Push API + VAPID 키 생성
- 알림 구독 관리 (DB 저장)
- 서버 측 스케줄러 (또는 클라이언트 측 타이머)
- 알림 설정 UI (경로별 알림 on/off, 사전 알림 시간)
- `NotificationPreference` 테이블 추가

### 우선순위: ★★★★☆
### 예상 난이도: 상

---

## 3. 역방향 경로 원클릭 생성

### 배경
출퇴근 경로는 대부분 출발지↔도착지가 반대인 쌍으로 존재한다. 현재는 "출근" 경로를 저장한 후 "퇴근" 경로를 별도로 검색해서 저장해야 한다.

### 개선 내용
- **역방향 생성 버튼**: 저장된 경로의 출발지/도착지를 뒤집어 새 경로 검색
- **자동 타입 지정**: 원래 "출근"이면 역방향은 "퇴근"으로 자동 설정
- **별칭 자동 생성**: "강남 → 판교" → "판교 → 강남 (퇴근)"

### 기대 효과
- 경로 설정 시간 절반 감소
- 출퇴근 경로 쌍 관리 편의성

### 구현 범위
- 경로 목록에 "역방향 생성" 버튼 추가
- 출발지/도착지 swap 후 자동 경로 검색 API 호출
- 결과 선택 → 저장 플로우

### 우선순위: ★★★★★ (최우선)
### 예상 난이도: 하

---

## 4. 출퇴근 시간대 자동 감지 및 경로 필터링

### 배경
현재 대시보드에 모든 저장 경로가 표시된다. 아침에는 "출근" 경로만, 저녁에는 "퇴근" 경로만 보고 싶은 경우가 많다. 이미 `routeType` 필드가 있으므로 이를 활용할 수 있다.

### 개선 내용
- **시간대 기반 자동 필터**: 오전(06~12시)에는 "출근" 우선, 오후(17~23시)에는 "퇴근" 우선
- **수동 필터 토글**: "전체 / 출근 / 퇴근 / 기타" 필터 버튼
- **스마트 정렬**: 현재 시간대에 해당하는 경로를 상단에 배치

### 기대 효과
- 불필요한 경로 노출 감소
- 대시보드 가독성 향상
- 출퇴근 시나리오에 최적화된 UX

### 구현 범위
- 대시보드 상단 필터 UI 추가
- 시간대 감지 로직 (`time-utils.ts` 확장)
- 경로 정렬 알고리즘 수정
- 사용자 시간대 설정 (선택사항)

### 우선순위: ★★★★☆
### 예상 난이도: 하

---

## 5. 출퇴근 소요시간 통계 및 기록

### 배경
매일 반복되는 출퇴근이지만 실제 소요 시간이 요일/시간대별로 어떻게 다른지 데이터가 없다. 과거 ETA 데이터를 축적하면 유용한 인사이트를 제공할 수 있다.

### 개선 내용
- **ETA 기록 저장**: 대시보드 조회 시 ETA 결과를 DB에 기록
- **일별/주별 통계**: 평균 소요시간, 최소/최대 소요시간 차트
- **요일별 패턴**: 월~금 요일별 평균 출퇴근 시간 비교
- **통계 페이지**: 차트와 함께 출퇴근 패턴을 시각화

### 기대 효과
- 출퇴근 패턴 파악
- 최적 출발 시간 결정에 도움
- 데이터 기반 의사결정 지원

### 구현 범위
- `ETARecord` 테이블 추가 (routeId, timestamp, totalETA, breakdown)
- ETA 조회 시 자동 기록 로직
- `/statistics` 페이지 신규 개발
- 차트 라이브러리 도입 (Recharts 또는 Chart.js)
- 통계 API 엔드포인트

### 우선순위: ★★★☆☆
### 예상 난이도: 중

---

## 6. 다크/라이트 모드 수동 토글

### 배경
현재 OS 설정(`prefers-color-scheme`)에만 따라 다크/라이트 모드가 결정된다. 사용자가 직접 모드를 선택하고 싶은 경우가 있다.

### 개선 내용
- **모드 토글 버튼**: 헤더 또는 프로필에 다크/라이트/시스템 모드 선택
- **설정 저장**: localStorage 또는 DB에 사용자 선호 저장
- **즉시 반영**: 페이지 새로고침 없이 테마 전환

### 기대 효과
- 사용자 선호도에 따른 테마 선택
- 밝은 환경에서 라이트 모드, 어두운 환경에서 다크 모드 자유 전환

### 구현 범위
- 테마 상태 관리 (Context 또는 Cookie)
- 토글 UI 컴포넌트
- `globals.css` 테마 클래스 방식으로 전환
- HTML `data-theme` 속성 활용

### 우선순위: ★★★☆☆
### 예상 난이도: 하

---

## 7. 경로 검색 결과 상세 비교

### 배경
경로 검색 시 여러 경로가 표시되지만 비교가 쉽지 않다. 소요 시간, 요금, 환승 횟수 등을 한눈에 비교할 수 있으면 좋겠다.

### 개선 내용
- **비교 뷰**: 검색 결과를 표 형태로 비교 (시간/요금/환승/거리)
- **정렬 옵션**: 최단시간/최저요금/최소환승 기준 정렬
- **경로 시각화**: 각 구간(leg)을 타임라인 형태로 시각화
- **예상 도착 시간 표시**: 현재 시각 기준 예상 도착 시간

### 기대 효과
- 최적 경로 선택이 쉬워짐
- 경로 간 trade-off를 명확하게 파악

### 구현 범위
- 검색 결과 정렬 옵션 UI
- 비교 테이블 컴포넌트
- 타임라인 시각화 컴포넌트
- 현재 시각 기반 도착 시간 계산

### 우선순위: ★★★☆☆
### 예상 난이도: 중

---

## 8. 위젯형 미니 대시보드

### 배경
대시보드 전체를 열지 않아도 빠르게 ETA를 확인할 수 있는 축약형 뷰가 있으면 편리하다.

### 개선 내용
- **미니 뷰 모드**: 기본 경로 1개의 ETA만 초간결하게 표시
- **URL 파라미터**: `/?mini=true`로 미니 모드 진입
- **PIP(Picture-in-Picture) 스타일**: 작은 플로팅 위젯처럼 표시
- **PWA 숏컷**: 미니 모드로 바로 실행하는 앱 숏컷

### 기대 효과
- 빠른 ETA 확인 (1초 이내)
- 다른 작업 중에도 ETA 모니터링

### 구현 범위
- 미니 대시보드 레이아웃 컴포넌트
- URL 쿼리 파라미터 처리
- PWA 숏컷 매니페스트 설정
- 반응형 스타일링

### 우선순위: ★★☆☆☆
### 예상 난이도: 중

---

## 9. 경로별 메모 및 팁

### 배경
특정 경로에 대해 "2번 출구가 빠름", "환승 시 엘리베이터 이용" 등의 개인 메모를 남기고 싶은 경우가 있다.

### 개선 내용
- **경로 메모 필드**: 각 경로에 자유 텍스트 메모 저장
- **구간별 팁**: 특정 leg(구간)에 대한 메모 (예: "환승 통로 3분 소요")
- **대시보드 표시**: 메모가 있는 경로에 아이콘 표시, 클릭 시 메모 확인

### 기대 효과
- 출퇴근 노하우 축적
- 반복 출퇴근 시 참고 정보 빠르게 확인

### 구현 범위
- `SavedRoute` 테이블에 `memo` 필드 추가
- 메모 입력/수정 UI
- 대시보드 메모 표시 컴포넌트

### 우선순위: ★★☆☆☆
### 예상 난이도: 하

---

## 10. 날씨 연동 안내

### 배경
비/눈 오는 날은 교통 지연이 잦다. 현재 날씨 상황을 대시보드에 표시하면 출발 시간을 조절하는 데 도움이 된다.

### 개선 내용
- **현재 날씨 표시**: 대시보드 상단에 현재 기온, 날씨 상태 표시
- **악천후 경고**: 비/눈/폭우 시 "교통 지연 가능" 경고 배너
- **체감 소요시간 안내**: 날씨에 따라 도보 구간 소요시간 주의 문구

### 기대 효과
- 기상 상황에 따른 출발 시간 조절
- 우산 등 준비물 알림 효과

### 구현 범위
- 기상청 API 또는 OpenWeatherMap 연동
- 날씨 표시 컴포넌트
- 악천후 감지 로직
- 도보 구간 날씨 주의 문구

### 우선순위: ★★☆☆☆
### 예상 난이도: 중

---

## 구현 우선순위 로드맵

### Phase 1 — 핵심 UX 개선 (즉시 가치 제공)
| # | 기능 | 난이도 | 우선순위 |
|---|------|--------|----------|
| 1 | PWA 전환 | 중 | ★★★★★ |
| 3 | 역방향 경로 원클릭 생성 | 하 | ★★★★★ |
| 4 | 시간대별 경로 자동 필터링 | 하 | ★★★★☆ |

### Phase 2 — 알림 및 개인화
| # | 기능 | 난이도 | 우선순위 |
|---|------|--------|----------|
| 2 | 푸시 알림 | 상 | ★★★★☆ |
| 6 | 다크/라이트 모드 토글 | 하 | ★★★☆☆ |
| 9 | 경로별 메모 | 하 | ★★☆☆☆ |

### Phase 3 — 데이터 & 인사이트
| # | 기능 | 난이도 | 우선순위 |
|---|------|--------|----------|
| 5 | 소요시간 통계 | 중 | ★★★☆☆ |
| 7 | 경로 검색 결과 비교 | 중 | ★★★☆☆ |

### Phase 4 — 부가 기능
| # | 기능 | 난이도 | 우선순위 |
|---|------|--------|----------|
| 8 | 미니 대시보드 위젯 | 중 | ★★☆☆☆ |
| 10 | 날씨 연동 | 중 | ★★☆☆☆ |

---

## 기술적 고려사항

### 공통
- 모든 신규 기능은 기존 아키텍처(서비스 레이어 패턴)를 따름
- TypeScript strict 모드 유지
- Zod 스키마 검증 적용
- 에러 처리는 기존 `errors.ts` 패턴 활용

### PWA 관련
- Next.js 16 호환 PWA 라이브러리 선택 필요 (Serwist 권장)
- Service Worker 캐싱 전략: 앱 셸은 Cache First, API 데이터는 Network First

### DB 스키마 변경
- Phase 2에서 `NotificationPreference` 테이블 추가
- Phase 3에서 `ETARecord` 테이블 추가
- Prisma 마이그레이션으로 관리

### API 비용
- 날씨 API 추가 시 호출 빈도 관리 필요 (1시간 캐싱 권장)
- 기존 카카오 API 레이트 리미터 패턴 재활용 가능
